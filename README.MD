# DFKI DAYSTREAM Corpus

This repository contains the DFKI DAYSTREAM Corpus, a dataset of 3541 German-language documents that have been annotated with fine-grained geo-entities, such as _streets_, _stops_ and _routes_, as well as standard named entity types (organization, date, number, etc). All location-related entities have been linked to either Open Street Map identifiers or database ids of Deutsche Bahn / Rhein-Main-Verkehrsverbund. The corpus has also been annotated with a set of 8 traffic-related n-ary relations and events, such as _Accidents_, _Traffic jams_, and _Canceled Routes_. It consists of Twitter messages, and traffic reports from e.g. radio stations, police and public transport providers. It allows for training and evaluating both named entity recognition algorithms that aim for fine-grained typing of geo-entities, entity linking of these entities, as well as n-ary relation extraction systems.

You can find the description of an initial version of the corpus here: [https://www.dfki.de/web/forschung/projekte-publikationen/publikationen/publikation/9427/](https://www.dfki.de/web/forschung/projekte-publikationen/publikationen/publikation/9427/)

The corpus is provided in two formats - AVRO and JSON, with train/dev/test splits. For details on the schema used for storing annotations, see below. Due to Github storage limitations, we offer two versions of the corpus - a version without geo-information which is included in this repository, and an externally hosted version which includes WKB data (and is hence much larger, ~1.2GB) :

 * [Daystream Corpus Version 1 (May 2020) - without geo-information](v1_20200511/)
 * [Daystream Corpus Version 1 (May 2020) - with geo-information](https://cloud.dfki.de)

## Dataset Statistics

|  | Twitter | RSS | Total |
| ---- | ---- | ---- | ---- |
| docs | 2825| 716 | 3541 |
| tokens | 69188 | 34630 | 103818 |
| entities | 15280 | 8112 | 23392 |
| relations | 365 | 427 | 792 |
| docs with annotated relations | 305 | 338 | 643 |
| linked entities (org,loc) | 5138 | 3331 | 8469 |
| NIL entities | 4764 | 1698 | 6462 |
| first-date |	Sat May 23 20:48:32 CEST 2015 |	Fri Jan 08 10:50:49 CET 2016 |	Sat May 23 20:48:32 CEST 2015 |
| last-date |Mon Apr 01 09:18:25 CEST 2019 |	Sun Mar 31 18:10:05 CEST 2019 |	Mon Apr 01 09:18:25 CEST 2019 |

## Use

The DFKI Daystream Corpus is released as [CC-BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/). If you use this data, you should cite one of the following publication(s):

_A German Corpus for Fine-Grained Named Entity Recognition and Relation Extraction of Traffic and Industry Events. Martin Schiersch, Veselina Mironova, Maximilian Schmitt, Philippe Thomas, Aleksandra Gabryszak, Leonhard Hennig. Proceedings of LREC, 2018._ [(bib)](paper.bib) [(pdf)](https://www.dfki.de/fileadmin/user_upload/import/9427_lrec_smartdata_corpus.pdf)

## Format

The corpus consists of Documents which store the original text and all annotations, according to the following AVRO schema:

 * [document.avsc](document.avsc)

You can use the following JAVA tools to read the AVRO version of the corpus:

 * [Corpus Reader Tools](sdw-tools-1.0-SNAPSHOT.jar)

To read the corpus, use the following code snippet:

   ```java
   File inputFile = new File("train.avro");
   DataFileReader<Document> reader = AvroUtils.createReader(inputFile);
   while (reader.hasNext()) {
      Document doc = reader.next();
      // do something
   }

   ```

Each document contains a list of ConceptMentions, which correspond to Named Entities and other typed concepts (e.g. trigger phrases):

   ```java
   for (ConceptMention c : doc.getConceptMentions()) {
       String nerTag = c.getType();
       String value = c.getNormalizedValue();
       int start = c.getSpan().getStart();
       int end = c.getSpan().getEnd();
       String originalText = doc.getText().substring(start, end);
       // etc ...
   }
   ```

Each ConceptMention contains a list of reference ids. The first reference id with key "spreeDBReferenceId" refers to ids of the Daystream project's internal knowledge bases. For "location-city" entities, there is a second id "osm_id", which resolves to Open Street Map identifiers. For "location-stop" and "location-route", we are currently unable to provide the proprietary ids from Deutsche Bahn or Rhein-Main-Verkehrsverbund, and thus can only supply geo-information for resolution (see below). For "location-street", the ids are autogenerated when merging road segments from Open Street Map.

   ```java
   for (Reference r : c.getRefids()) {
       if (r.getKey().equals("osmRelationId")) {
           String osmId = r.getValue();
       }
   }
   ```

Since we cannot always guarantee the use of well-established IDs, we also include geo-information for each linked location:

   ```java
   for (String attributeKey : c.getAttributes().keySet()) {
       if (attributeKey.equals("wkb")) {
           String wkbPolygon = c.getAttributes.get(attributeKey);
       }
       if (attributeKey.equals("wkb-point")) {
           String wkbPoint = c.getAttributes.get(attributeKey);
       }
       if (attributeKey.equals("latitude")) {
           String latitude = c.getAttributes.get(attributeKey);
       }
       if (attributeKey.equals("longitude")) {
           String longitude = c.getAttributes.get(attributeKey);
       }
   }
   ```


You can retrieve RelationMentions:

   ```java
   for (RelationMention r : doc.getRelationMentions()) {
       String relationType = c.getName();
       int start = c.getSpan().getStart();
       int end = c.getSpan().getEnd();
       String originalText = doc.getText().substring(start, end);
       for (RelationArgument arg : r.getRelationArguments()) {
           String role = arg.getRole();
           ConceptMention c = arg.getConceptMention();
           // ...
       }
       // ...
   }
   ```

ConceptMentions and RelationMentions are stored at the document level, and for each sentence as well. You can access a sentence's list of RelationMentions using:

   ```java
   for (Sentence s : doc.getSentences()) {
       List<RelationMention> relationMentions = s.getRelationMentions();
       // ...
   }
   ```



## Annotation Guidelines

[Daystream Corpus Annotation Guidelines v1.0 (Feb 2018)](SmartData_Corpus_Annotation_Guidelines_Feb_2018_v1.0.pdf)
